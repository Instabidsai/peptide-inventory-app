# Auto-Heal Report

**Date**: 2/26/2026, 1:24:34 AM
**Issues detected**: 3
**Claude Code ran**: Yes
**CC session**: Completed
**Post-fix tsc**: PASS
**Post-fix tests**: PASS
**Auto-pushed**: No

## Issues Detected

### auto_error

- **Auto Error (fallback): console_error: [app] Auto-protocol generation failed (non-blocking): {"code":"PG**: console_error: [app] Auto-protocol generation failed (non-blocking): {"code":"PGRST204","details":null,"hint":null,"message":"Could not find the 'notes' column of 'protocol_items' in the schema cache"
- **Auto Error (fallback): uncaught_error: ResizeObserver loop completed with undelivered notifications.**: uncaught_error: ResizeObserver loop completed with undelivered notifications.
- **Auto Error (fallback): fetch_error: HTTP 401 : https://mckkegmkpqdicudnfhor.supabase.co/functions/v1/in**: fetch_error: HTTP 401 : https://mckkegmkpqdicudnfhor.supabase.co/functions/v1/invite-user

## Claude Code Output

```
All 3 issues fixed. Here's the summary:

## Fixes Applied

### Issue 1: `PGRST204` — Missing `notes` column on `protocol_items`
- **Root cause**: `src/lib/auto-protocol.ts` inserts a `notes` field into `protocol_items`, and `supabase/functions/chat-with-ai/index.ts` selects `notes` and `route` — but neither column exists in the DB schema.
- **Fix**: Added migration `supabase/migrations/20260226_add_protocol_items_notes_route.sql` to add `notes text` and `route text` columns. Updated `supabase/schema.sql` to match.

### Issue 2: `ResizeObserver loop completed with undelivered notifications`
- **Root cause**: The `auto-error-reporter.ts` already filters ResizeObserver from `unhandledrejection` events (line 266), but the same error fires as an `uncaught_error` via the `window.error` event handler, which had no such filter.
- **Fix**: Added `ResizeObserver` filter to the `window.error` handler in `src/lib/auto-error-reporter.ts`.

### Issue 3: `HTTP 401` on `invite-user` edge function
- **Root cause**: The fetch interceptor in `auto-error-reporter.ts` captures ALL non-2xx responses from Supabase URLs. When the SystemHealth page sends `{ health_check: true }` probes to edge functions, stale JWTs cause expected 401 responses that get reported as real errors.
- **Fix**: Added health check detection to the fetch interceptor — requests with `"health_check"` in the body are now excluded from error reporting.

### Verification
- **tsc --noEmit**: 0 errors
- **vitest run**: 31 files, 342 tests, all passing
```

